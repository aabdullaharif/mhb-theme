{% comment %}
  SellersDash collect child product details
{% endcomment %}
{% assign shsd_product_details = product.metafields.sellersdash.shsdproducts %}
{% if shsd_product_details.product_type == "shsd_parent" %}
  {% assign shsd_product_handles = product.handle %}
  {% assign shsd_product_handles = shsd_product_handles | concat: shsd_product_details.handles %}
  {% for shsd_handle in shsd_product_handles %}
    {% assign shsd_single_product = all_products[shsd_handle] %}
    {% assign shsd_product_variants = shsd_product_variants | concat: shsd_single_product.variants %}
    {% assign shsd_product_media = shsd_product_media | concat: shsd_single_product.media %}
    {% assign shsd_product_images = shsd_product_images | concat: shsd_single_product.images %}
  {% endfor %}
  {% assign shsd_product_options_with_values = shsd_product_details.options_with_values %}
{% else %}
  {% assign shsd_product_options_with_values = product.options_with_values %}
  {% assign shsd_product_variants = product.variants %}
  {% assign shsd_product_media = product.media %}
  {% assign shsd_product_images = product.images %}
{% endif %}
{% assign shsd_product_options = shsd_product_options_with_values | map: "name" %}

{%- assign color_label_list = 'general.label.color' | t | replace: ', ', ',' | downcase | split: ',' -%}
{%- assign color_white_label = 'general.label.white' | t | downcase -%}
{%- assign size_label_list = 'general.label.size' | t | replace: ', ', ',' | downcase | split: ',' -%}
{%- assign product_form_id = 'product-form-' | append: section.id | append: '-' | append: product.id -%}

<div class="product-form">
  {%- for block in section.blocks -%}
    {%- case block.type -%}
      {%- comment -%}
        ----------------------------------------------------------------------------------------------------------------
        APP BLOCK TYPE
        ----------------------------------------------------------------------------------------------------------------
      {%- endcomment -%}
    {%- when '@app' -%}
      {%- render block -%}

    {%- when 'stockStatus' -%}
  

    {%- when 'price' -%}
      <div class="product__info {{ product.type | downcase | replace: ' ', '-' }} {% if product.available %}available{% endif %} {% if product.price_max < 7000 %}no-shop-pay{%endif%}">
          <div
      class="product-meta__price-list-container"
      role="region"
      aria-live="polite">
      <div class="price-list" data-product-price-list>
        {%- if shsd_product_variants[0].compare_at_price > shsd_product_variants[0].price -%}
          <span class="price price--highlight price--large">
            <span class="visually-hidden">{{ 'product.general.sale_price' | t }}</span>

            {%- if settings.currency_code_enabled -%}
              {{- shsd_product_variants[0].price | money_with_currency -}}
            {%- else -%}
              {{- shsd_product_variants[0].price | money -}}
            {%- endif -%}
          </span>

          <span class="price price--compare">
            <span class="visually-hidden">{{ 'product.general.regular_price' | t }}</span>

            {%- if settings.currency_code_enabled -%}
              {{- shsd_product_variants[0].compare_at_price | money_with_currency -}}<span class="compare-at-new"> NEW</span>
            {%- else -%}
              {{- shsd_product_variants[0].compare_at_price | money -}}<span class="compare-at-new"> NEW</span>
            {%- endif -%}
          </span>
        {%- else -%}
          <span class="price price--large">
            <span class="visually-hidden">{{ 'product.general.sale_price' | t }}</span>
            {%- if settings.currency_code_enabled -%}
              {{- shsd_product_variants[0].price | money_with_currency -}}
            {%- else -%}
              {{- shsd_product_variants[0].price | money -}}
            {%- endif -%}
          </span>
        {%- endif -%}

        {%- if shsd_product_variants[0].unit_price_measurement -%}
          <div class="price text--subdued">
            <div class="unit-price-measurement">
              <span class="unit-price-measurement__price">{{ shsd_product_variants[0].unit_price | money }}</span>
              <span class="unit-price-measurement__separator">/</span>

              {%- if shsd_product_variants[0].unit_price_measurement.reference_value != 1 -%}
                <span class="unit-price-measurement__reference-value">{{ shsd_product_variants[0].unit_price_measurement.reference_value }}</span>
              {%- endif -%}

              <span class="unit-price-measurement__reference-unit">{{ shsd_product_variants[0].unit_price_measurement.reference_unit }}</span>
            </div>
          </div>
        {%- endif -%}
      </div>

      <div class="product-meta__label-list label-list" data-product-label-list>
        {%- unless shsd_product_variants[0].available -%}
          <span class="label label--subdued">{{ 'collection.product.sold_out' | t }}</span>
        {%- elsif shsd_product_variants[0].compare_at_price > shsd_product_variants[0].price -%}
          {%- if settings.discount_mode == 'percentage' -%}
            {%- assign savings = shsd_product_variants[0].compare_at_price | minus: shsd_product_variants[0].price | times: 100.0 | divided_by: shsd_product_variants[0].compare_at_price | round | append: '%' -%}
          {%- else -%}
            {%- capture savings -%}
              {{ shsd_product_variants[0].compare_at_price | minus: shsd_product_variants[0].price | money }}{%- endcapture -%}
          {%- endif -%}

          <span class="label label--highlight">{{ 'collection.product.discount_html' | t: savings: savings }}</span>
        {%- endunless -%}
      </div>
    </div>

    {%- if section.settings.show_taxes_included -%}
      {%- if cart.taxes_included or shop.shipping_policy.body != blank -%}
        <p class="product-meta__taxes-included text--small">
          {%- if cart.taxes_included -%}
            {{ 'product.general.include_taxes' | t }}
          {%- endif -%}

          {%- if shop.shipping_policy.body != blank -%}
            {{ 'product.general.shipping_policy_html' | t: link: shop.shipping_policy.url }}
          {%- endif -%}
        </p>
      {%- endif -%}
    {%- endif -%}

    <product-payment-terms form-id="{{ product_form_id }}">
      {%- assign product_installment_form_id = 'product-installment-form-' | append: section.id | append: '-' | append: product.id -%}

      {%- form 'product', product, id: product_installment_form_id -%}
        <input
          type="hidden"
          name="id"
          value="{{ shsd_product_variants[0].id }}">
        {{- form | payment_terms -}}
      {%- endform -%}
    </product-payment-terms>
</div>

      {%- comment -%}
        ----------------------------------------------------------------------------------------------------------------
        VARIANT PICKER BLOCK TYPE
        ----------------------------------------------------------------------------------------------------------------
      {%- endcomment -%}
    {%- when 'variant_picker' -%}
      {%- unless product.has_only_default_variant or block.settings.hide_sold_out_variants and product.available == false -%}
        {%- assign size_chart_page = block.settings.size_chart_page -%}
        {%- assign found_size_option = false -%}

        <product-variants handle="{{ product.handle }}" form-id="{{ product_form_id }}" {% if update_url %}update-url{% endif %} {% if block.settings.hide_sold_out_variants %}hide-sold-out-variants{% endif %} class="product-form__variants" {{ block.shopify_attributes }}>
          {%- for option in shsd_product_options_with_values -%}
            {%- assign option_downcase = option.name | downcase -%}
            {%- capture option_id -%}option-{{ section.id }}-{{ template.suffix }}-{{ product.id }}-{{ forloop.index }}{%- endcapture -%}

            {%- assign selector_type = block.settings.selector_mode -%}

            {% if color_label_list contains option_downcase %}
              {%- assign selector_type = block.settings.color_mode -%}
              {% if selector_type == 'color' %}
                {%- assign selector_type = 'dropdown' -%}
              {%- endif -%}
              {%- if selector_type == 'variant_image' -%}
                {%- comment -%}To use this mode every variant must have an attached media{%- endcomment -%}
                {%- for variant in product.variants -%}
                  {%- unless variant.featured_media -%}
                    {%- assign selector_type = 'color' -%}
                    {%- break -%}
                  {%- endunless -%}
                {%- endfor -%}
              {%- endif -%}
            {%- endif -%}

            <div class="product-form__option-selector" data-selector-type="{{ selector_type | replace: '_', '-' | escape }}">
              <div class="product-form__option-info">
                <span class="product-form__option-name">{{ option.name }}:</span>

                {%- if selector_type != 'dropdown' -%}
                  <span id="{{ option_id }}-value" class="product-form__option-value">{{ option.selected_value }}</span>
                {%- endif -%}

                {%- if size_chart_page != blank and size_label_list contains option_downcase -%}
                  {%- assign found_size_option = true -%}
                  <button type="button" is="toggle-button" class="product-form__option-link link text--subdued hidden-phone" aria-controls="product-{{ section.id }}-{{ product.id }}-size-chart-drawer" aria-expanded="false">{{ 'product.general.size_chart' | t }}</button>
                  <button type="button" is="toggle-button" class="product-form__option-link link text--subdued hidden-tablet-and-up" aria-controls="product-{{ section.id }}-{{ product.id }}-size-chart-popover" aria-expanded="false">{{ 'product.general.size_chart' | t }}</button>
                {%- endif -%}
              </div>

              {%- case selector_type -%}
                {%- when 'variant_image' -%}
                  <div class="variant-swatch-list">
                    {%- assign option_position0 = option.position | minus: 1 -%}

                    {%- for value in option.values -%}
                      {%- comment -%}We search for the first variant that has an image for this color{%- endcomment -%}
                      {%- for variant in product.variants -%}
                        {%- if variant.options[option_position0] == value -%}
                          <div class="variant-swatch">
                            <input class="variant-swatch__radio visually-hidden" type="radio" name="option{{ option.position }}" form="{{ product_form_id }}" id="{{ option_id }}-{{ forloop.index }}" value="{{ value | escape }}" data-bind-value="{{ option_id }}-value" {% if value == option.selected_value %}checked="checked"{% endif %} aria-label="{{ value | escape }}">
                            <label class="variant-swatch__item" for="{{ option_id }}-{{ forloop.index }}">
                              <span class="visually-hidden">{{ value }}</span>
                              <img class="variant-swatch__image" loading="lazy" sizes="(max-width: 740px) 64px, 72px" {% render 'image-attributes', image: variant.featured_media, sizes: '64,72,128,144,192,216' %}>
                            </label>
                          </div>
                          {%- break -%}
                        {%- endif -%}
                      {%- endfor -%}
                    {%- endfor -%}
                  </div>

                {%- when 'color' -%}
                  <div class="select-wrapper">
                    <combo-box initial-focus-selector="[aria-selected='true']" id="{{ option_id }}-combo-box" class="combo-box">
                      <span class="combo-box__overlay"></span>

                      <header class="combo-box__header">
                        <p class="combo-box__title heading h6">{{ option.name }}</p>

                        <button type="button" class="combo-box__close-button tap-area" data-action="close" title="{{ 'general.accessibility.close' | t | escape }}">
                          {%- render 'icon' with 'close' -%}
                        </button>
                      </header>

                      <div class="combo-box__option-list" role="listbox">
                        {%- for value in option.values -%}
                          <button type="button" role="option" class="combo-box__option-item" value="{{ value | escape }}" aria-selected="{% if value == option.selected_value %}true{% else %}false{% endif %}">{{ value }}</button>
                        {%- endfor -%}
                      </div>

                      <select class="visually-hidden" name="option{{ option.position }}" form="{{ product_form_id }}" data-bind-value="{{ option_id }}-value" aria-label="{{ option.name | escape }}">
                        <option value="" {% if value == option.selected_value %}selected{% endif %}>Select {{ option.name }}...</option>
                        {%- for value in option.values -%}
                          <option value="{{ value | escape }}" {% if value == option.selected_value %}selected{% endif %}>{{ value }}</option>
                        {%- endfor -%}
                      </select>
                    </combo-box>

                    <button type="button" is="toggle-button" class="select" aria-expanded="false" aria-haspopup="listbox" aria-controls="{{ option_id }}-combo-box">
                      <span id="{{ option_id }}-value" class="select__selected-value">{{ option.selected_value }}</span>
                      {%- render 'icon' with 'chevron' -%}
                    </button>
                  </div>

                {%- when 'block' -%}
                  <div class="block-swatch-list">
                    {%- for value in option.values -%}
                      <div class="block-swatch">
                        <input class="block-swatch__radio visually-hidden" type="radio" name="option{{ option.position }}" form="{{ product_form_id }}" id="{{ option_id }}-{{ forloop.index }}" value="{{ value | escape }}" {% if value == option.selected_value %}checked="checked"{% endif %} data-bind-value="{{ option_id }}-value">
                        <label class="block-swatch__item" for="{{ option_id }}-{{ forloop.index }}">{{ value }}</label>
                      </div>
                    {%- endfor -%}
                  </div>

                {%- when 'dropdown' -%}
                  <div class="select-wrapper">
                    <combo-box initial-focus-selector="[aria-selected='true']" id="{{ option_id }}-combo-box" class="combo-box">
                      <span class="combo-box__overlay"></span>

                      <header class="combo-box__header">
                        <p class="combo-box__title heading h6">{{ option.name }}</p>

                        <button type="button" class="combo-box__close-button tap-area" data-action="close" title="{{ 'general.accessibility.close' | t | escape }}">
                          {%- render 'icon' with 'close' -%}
                        </button>
                      </header>

                      <div class="combo-box__option-list" role="listbox">
                        {%- for value in option.values -%}
                          <button type="button" role="option" class="combo-box__option-item" value="{{ value | escape }}" aria-selected="{% if value == option.selected_value %}true{% else %}false{% endif %}">{{ value }}</button>
                        {%- endfor -%}
                      </div>

                      <select class="visually-hidden" name="option{{ option.position }}" form="{{ product_form_id }}" data-bind-value="{{ option_id }}-value" aria-label="{{ option.name | escape }}">
                        <option value="" {% if value == option.selected_value %}selected{% endif %}>Select {{ option.name }}...</option>
                        {%- for value in option.values -%}
                          <option value="{{ value | escape }}" {% if value == option.selected_value %}selected{% endif %}>{{ value }}</option>
                        {%- endfor -%}
                      </select>
                    </combo-box>

                    <button type="button" is="toggle-button" class="select" aria-expanded="false" aria-haspopup="listbox" aria-controls="{{ option_id }}-combo-box">
                      <span id="{{ option_id }}-value" class="select__selected-value">{{ option.selected_value }}</span>
                      {%- render 'icon' with 'chevron' -%}
                    </button>
                  </div>
              {%- endcase -%}
            </div>
          {%- endfor -%}

          <noscript>
            <label class="input__block-label" for="product-select-{{ section.id }}-{{ product.id }}">{{ 'product.form.variant' | t }}</label>

            <div class="select-wrapper">
              <select class="select" autocomplete="off" id="product-select-{{ section.id }}-{{ product.id }}" name="id" form="{{ product_form_id }}">
                {%- for variant in product.variants -%}
                  <option {% if variant == shsd_product_variants[0] %}selected="selected"{% endif %} {% unless variant.available %}disabled="disabled"{% endunless %} value="{{ variant.id }}" data-sku="{{ variant.sku }}">{{ variant.title }} - {{ variant.price | money }}</option>
                {%- endfor -%}
              </select>

              {%- render 'icon' with 'chevron' -%}
            </div>
          </noscript>
        </product-variants>
      {%- endunless -%}

      {%- comment -%}
        ----------------------------------------------------------------------------------------------------------------
        LINE ITEM PROPERTY
        ----------------------------------------------------------------------------------------------------------------
      {%- endcomment -%}
    {%- when 'line_item_property' -%}
      {%- if block.settings.label != blank -%}
        {%- case block.settings.type -%}
          {%- when 'text' -%}
            {%- if block.settings.allow_long_text -%}
              <div class="product-form__line-item-property" {{ block.shopify_attributes }}>
                <label class="input__block-label" for="line-item-{{ section.id }}-{{ block.id }}">{{ block.settings.label | escape }}:</label>
                <textarea {% if block.settings.required %}required{% endif %} id="line-item-{{ section.id }}-{{ block.id }}" form="{{ product_form_id }}" class="input__field input__field--textarea" name="properties[{{ block.settings.label | escape }}]"></textarea>
              </div>
            {% else %}
              <div class="product-form__line-item-property" {{ block.shopify_attributes }}>
                <label class="input__block-label" for="line-item-{{ section.id }}-{{ block.id }}">{{ block.settings.label | escape }}:</label>
                <input {% if block.settings.required %}required{% endif %} id="line-item-{{ section.id }}-{{ block.id }}" form="{{ product_form_id }}" type="text" class="input__field" name="properties[{{ block.settings.label | escape }}]">
              </div>
            {%- endif -%}

          {%- when 'checkbox' -%}
            <div class="product-form__line-item-property" {{ block.shopify_attributes }}>
              <div class="checkbox-container">
                <input type="hidden" form="{{ product_form_id }}" class="checkbox" name="properties[{{ block.settings.label | escape }}]" value="{{ block.settings.unchecked_value | escape }}">
                <input type="checkbox" form="{{ product_form_id }}" class="checkbox" name="properties[{{ block.settings.label | escape }}]" id="line-item-{{ section.id }}-{{ block.id }}" value="{{ block.settings.checked_value | escape }}">
                <label for="line-item-{{ section.id }}-{{ block.id }}">{{ block.settings.label | escape }}</label>
              </div>
            </div>
        {%- endcase -%}
      {%- endif -%}

      {%- comment -%}
        ----------------------------------------------------------------------------------------------------------------
        TEXT
        ----------------------------------------------------------------------------------------------------------------
      {%- endcomment -%}
    {%- when 'text' -%}
      {% if block.settings.lead-in-check %}
        <div class="product-form__text" {{ block.shopify_attributes }}>
          {{ product.metafields.my_fields.lead_in }}
        </div>
      {% elsif block.settings.text != blank %}
        <div class="product-form__text" {{ block.shopify_attributes }}>
          {{- block.settings.text -}}
        </div>
      {%- endif -%}

      {%- comment -%}
        ----------------------------------------------------------------------------------------------------------------
        IMAGE
        ----------------------------------------------------------------------------------------------------------------
      {%- endcomment -%}
    {%- when 'image' -%}
      {% if block.settings.image != blank %}
        <div class="product-form__image product-form__image--{{ block.settings.image_alignment }}" {{ block.shopify_attributes }}>
          {%- capture image_sizes -%}
            {{ block.settings.image_width }}, {{ block.settings.image_width | times: 2 }}, {{ block.settings.image_width | times: 3 }}{%- endcapture -%}
          <img loading="lazy" style="max-width: {{ block.settings.image_width }}px" {% render 'image-attributes', image: block.settings.image, sizes: image_sizes %}>
        </div>
      {%- endif -%}

      {%- comment -%}
        ----------------------------------------------------------------------------------------------------------------
        BUTTON
        ----------------------------------------------------------------------------------------------------------------
      {%- endcomment -%}
    {%- when 'button' -%}
      {% if block.settings.link != blank and block.settings.text != blank %}
        <div class="product-form__button" {{ block.shopify_attributes }}>
          {%- if block.settings.background == 'rgba(0,0,0,0)' -%}
            {%- assign button_background = settings.primary_button_background -%}
          {%- else -%}
            {%- assign button_background = block.settings.background -%}
          {%- endif -%}

          {%- if block.settings.text_color == 'rgba(0,0,0,0)' -%}
            {%- assign button_text_color = settings.primary_button_text_color -%}
          {%- else -%}
            {%- assign button_text_color = block.settings.text_color -%}
          {%- endif -%}

          {%- capture button_background_rgb -%}
            {{ button_background.red }}, {{ button_background.green }}, {{ button_background.blue }}{%- endcapture -%}
          {%- capture button_text_color_rgb -%}
            {{ button_text_color.red }}, {{ button_text_color.green }}, {{ button_text_color.blue }}{%- endcapture -%}

          <a href="{{ block.settings.link }}" class="button button--primary {% if block.settings.stretch %}button--full{% endif %}" style="--primary-button-background: {{ button_background_rgb }}; --primary-button-text-color: {{ button_text_color_rgb }}">{{ block.settings.text | escape }}</a>
        </div>
      {%- endif -%}

      {%- comment -%}
        ----------------------------------------------------------------------------------------------------------------
        CUSTOM LIQUID
        ----------------------------------------------------------------------------------------------------------------
      {%- endcomment -%}
    {%- when 'liquid' -%}
      {% if block.settings.liquid != blank %}
        <div class="product-form__custom-liquid" {{ block.shopify_attributes }}>
          {{- block.settings.liquid -}}
        </div>
      {%- endif -%}

      {%- comment -%}
        ----------------------------------------------------------------------------------------------------------------
        QUANTITY SELECTOR
        ----------------------------------------------------------------------------------------------------------------
      {%- endcomment -%}
    {%- when 'quantity_selector' -%}
      {%- if request.page_type != 'password' and product.available -%}
        <div class="product-form__quantity" {{ block.shopify_attributes }}>
          <span class="product-form__quantity-label">{{ 'product.form.quantity' | t }}:</span>

          <quantity-selector class="quantity-selector">
            <button type="button" class="quantity-selector__button">
              <span class="visually-hidden">{{ 'cart.general.decrease_quantity' | t }}</span>
              {%- render 'icon' with 'minus-big' -%}
            </button>

            <input type="text" form="{{ product_form_id }}" is="input-number" class="quantity-selector__input" inputmode="numeric" name="quantity" autocomplete="off" min="1" value="1" size="2" aria-label="{{ 'product.form.quantity' | t | escape }}">

            <button type="button" class="quantity-selector__button">
              <span class="visually-hidden">{{ 'cart.general.increase_quantity' | t }}</span>
              {%- render 'icon' with 'plus-big' -%}
            </button>
          </quantity-selector>
        </div>
      {%- endif -%}

      {%- comment -%}
        ----------------------------------------------------------------------------------------------------------------
        PRODUCT DESCRIPTION
        ----------------------------------------------------------------------------------------------------------------
      {%- endcomment -%}
    {%- when 'description' -%}
      {%- if product.description != blank -%}
        <div class="product-form__description rte" {{ block.shopify_attributes }}>
          {{- product.description -}}
        </div>
      {%- endif -%}

      {%- comment -%}
        ----------------------------------------------------------------------------------------------------------------
        INVENTORY
        ----------------------------------------------------------------------------------------------------------------
      {%- endcomment -%}
    {%- when 'inventory' -%}
      {%- if product.template_suffix != 'pre-order' and product.available or shsd_product_variants[0].incoming -%}
        <product-inventory form-id="{{ product_form_id }}" {% unless shsd_product_variants[0].available or shsd_product_variants[0].incoming %}hidden{% endunless %} class="product-form__inventory-wrapper" {{ block.shopify_attributes }}>
          {%- if shsd_product_variants[0].available -%}
            {%- if shsd_product_variants[0].inventory_management and shsd_product_variants[0].inventory_policy == 'deny' and shsd_product_variants[0].inventory_quantity <= block.settings.low_inventory_threshold and block.settings.low_inventory_threshold > 0 -%}
              <span class="inventory inventory--low">{{ 'product.form.low_stock_with_quantity_count' | t: count: shsd_product_variants[0].inventory_quantity }}</span>
            {%- else -%}
              {%- if shsd_product_variants[0].inventory_policy == 'continue' and shsd_product_variants[0].inventory_quantity <= 0 and shsd_product_variants[0].requires_shipping -%}
                {%- if shsd_product_variants[0].incoming and shsd_product_variants[0].next_incoming_date -%}
                  {%- capture next_incoming_date -%}
                    {{ shsd_product_variants[0].next_incoming_date | date: format: 'date' }}{%- endcapture -%}
                  <span class="inventory inventory--low">{{ 'product.form.incoming_stock' | t: next_incoming_date: next_incoming_date }}</span>
                {%- else -%}
                  <span class="inventory inventory--low">{{ 'product.form.oversell_stock' | t }}</span>
                {%- endif -%}
              {%- else -%}
                <span class="inventory inventory--high">{{ 'product.form.in_stock' | t }}</span>
              {%- endif -%}
            {%- endif -%}
          {%- elsif shsd_product_variants[0].incoming -%}
            {%- if shsd_product_variants[0].next_incoming_date -%}
              {%- capture next_incoming_date -%}
                {{ shsd_product_variants[0].next_incoming_date | date: format: 'date' }}{%- endcapture -%}
              <span class="inventory inventory--low">{{ 'product.form.incoming_stock' | t: next_incoming_date: next_incoming_date }}</span>
            {%- else -%}
              <span class="inventory inventory--low">{{ 'product.form.oversell_stock' | t }}</span>
            {%- endif -%}
          {%- endif -%}

          <script type="application/json">
            {
                    {%- for variant in product.variants -%}
                {%- capture inventory_message -%}
                  {%- if variant.available -%}
                    {%- if variant.inventory_management and variant.inventory_policy == 'deny' and variant.inventory_quantity <= block.settings.low_inventory_threshold and block.settings.low_inventory_threshold > 0 -%} < span class = "inventory inventory--low" > {{ 'product.form.low_stock_with_quantity_count' | t: count: variant.inventory_quantity }} < /span>
                      {%- else -%}
                        {%- if variant.inventory_policy == 'continue' and variant.inventory_quantity <= 0 and variant.requires_shipping -%}
                          {%- if variant.incoming and variant.next_incoming_date -%}
                            {%- capture next_incoming_date -%}{{ variant.next_incoming_date | date: format: 'date' }}{%- endcapture -%}
                            <span class="inventory inventory--low">{{ 'product.form.incoming_stock' | t: next_incoming_date: next_incoming_date }}</span >
                    {%- else -%} < span class = "inventory inventory--low" > {{ 'product.form.oversell_stock' | t }} < /span>
                          {%- endif -%}
                        {%- else -%}
                          <span class="inventory inventory--high">{{ 'product.form.in_stock' | t }}</span >{%- endif -%}
                  {%- endif -%}
                {%- elsif variant.incoming -%}
                  {%- if variant.next_incoming_date -%}
                    {%- capture next_incoming_date -%}
                      {{ variant.next_incoming_date | date: format: 'date' }}{%- endcapture -%} < span class = "inventory inventory--low" > {{ 'product.form.incoming_stock' | t: next_incoming_date: next_incoming_date }} < /span>
                      {%- else -%}
                        <span class="inventory inventory--low">{{ 'product.form.oversell_stock' | t }}</span >{%- endif -%}
                {%- endif -%}
              {%- endcapture -%}

              "{{ variant.id }}": {{ inventory_message | json }}
              {% unless forloop.last %},{% endunless %}{%- endfor -%}
          }
          </script>
        </product-inventory>
      {%- endif -%}

      {%- comment -%}
        ----------------------------------------------------------------------------------------------------------------
        BUY BUTTONS
        ----------------------------------------------------------------------------------------------------------------
      {%- endcomment -%}
    {%- when 'buy_buttons' -%}
      {%- if request.page_type != 'password' -%}
        <div class="product-form__buy-buttons" {{ block.shopify_attributes }}>
          {%- form 'product', product, is: 'product-form', id: product_form_id -%}
            <input type="hidden" disabled name="id" value="{{ shsd_product_variants[0].id }}">

            <product-payment-container form-id="{{ product_form_id }}" {% if update_url %}id="MainPaymentContainer"{% endif %} class="product-form__payment-container" {{ block.shopify_attributes }}>
              <button id="AddToCart" is="loader-button" type="submit" {% unless block.settings.show_payment_button and template.suffix != 'quick-buy-popover' %}data-use-primary{% endunless %} data-product-add-to-cart-button data-button-content="{% if product.template_suffix == 'pre-order' %}{{ 'product.form.pre_order' | t | escape }}{% else %}{{ 'product.form.add_to_cart' | t | escape }}{% endif %}" class="product-form__add-button button {% unless shsd_product_variants[0].available %}button--ternary{% else %}{% if block.settings.show_payment_button and template.suffix != 'quick-buy-popover' %}button--secondary{% else %}button--primary{% endif %}{% endunless %} button--full" {% unless shsd_product_variants[0].available %}disabled{% endunless %}>
                {%- if shsd_product_variants[0].available -%}
                  {%- if product.template_suffix == 'pre-order' -%}
                    {{- 'product.form.pre_order' | t -}}
                  {%- else -%}
                    {{- 'product.form.add_to_cart' | t -}}
                  {%- endif -%}
                {%- else -%}
                  {{- 'product.form.sold_out' | t -}}
                {%- endif -%}
              </button>

              {%- if block.settings.show_payment_button and template.suffix != 'quick-buy-popover' -%}
                {{ form | payment_button }}

                {%- unless shsd_product_variants[0].available -%}
                  <style>
                    #shopify-section-{{ section.id }}.shopify-payment-button {
                      display: none;
                    }
                  </style>
                {%- endunless -%}
              {%- endif -%}
            </product-payment-container>
          {%- endform -%}
        </div>
      {%- endif -%}
<div class="status">
    {% comment %}
    Stock Logic Code Begin
    {% endcomment %}

    {% assign lt_tag = false %}

    {% assign policy = "deny" %}
    {% if product.variants.size > 1 %}
      {% for variant in product.variants %}
        {% if variant.inventory_policy != "deny" %}
          {% assign policy = "allow" %}
        {% endif %}
      {% endfor %}
    {% else %}
      {% if product.variants[0].inventory_policy != "deny" %}
        {% assign policy = "allow" %}
      {% endif %}
    {% endif %}

    {% assign out_stock_output = settings.output_asterisk %}
    {% assign in_stock_output = settings.output_three %}
    {% assign in_stock_has_inv_output = settings.output_three %}

    {% for t in product.tags %}
      {% if t == 'LT' or t == 'LT1' or t == 'LT2' %}
        {% assign lt_tag = true %}
      {% endif %}
    {% endfor %}

    {% if product.type == 'Fine Jewelry' %}
      {% if lt_tag %}

        {% if policy == "deny" %}
          {% assign out_stock_output = settings.output_seven %}
        {% else %}
          {% assign in_stock_output = settings.output_five %}
        {% endif %}

      {% else %}

        {% if policy == "deny" %}
          {% assign out_stock_output = settings.output_seven %}
        {% else %}
          {% assign in_stock_output = settings.output_four %}
        {% endif %}
      {% endif %}
    {% endif %}

    {% if product.type != 'Fashion Jewelry' and product.type != 'Fine Jewelry' and product.type != 'Recast Fashion Jewelry'and product.type != 'Sold Out' %}
      {% if policy == "deny" %}
        {% assign out_stock_output = settings.output_one %}
      {% endif %}
    {% else %}

      {% if product.vendor == 'Betsy & Iya' %}
        {% if product.type == 'Fashion Jewelry' %}
          {% if lt_tag %}

            {% if policy == "deny" %}
              {% assign out_stock_output = settings.output_one %}
            {% else %}
              {% assign in_stock_output = settings.output_two %}
            {% endif %}

          {% else %}

            {% if policy == "deny" %}
              {% assign out_stock_output = settings.output_one %}
            {% else %}
              {% assign in_stock_output = settings.output_two %}
            {% endif %}

          {% endif %}

        {% elsif product.type == 'Recast Fashion Jewelry' %}

          {% if lt_tag %}

            {% if policy == "deny" %}
              {% assign out_stock_output = settings.output_one %}
            {% else %}
              {% assign out_stock_output = settings.output_asterisk %}
            {% endif %}

          {% else %}

            {% if policy == "deny" %}
              {% assign out_stock_output = settings.output_one %}
            {% else %}
              {% assign out_stock_output = settings.output_asterisk %}
            {% endif %}

          {% endif %}

        {% elsif product.type == 'Sold Out' %}

          {% if lt_tag %}

            {% if policy == "deny" %}
              {% assign out_stock_output = settings.output_seven %}
            {% else %}
              {% assign out_stock_output = settings.output_asterisk %}
            {% endif %}

          {% else %}

            {% if policy == "deny" %}
              {% assign out_stock_output = settings.output_seven %}
            {% else %}
              {% assign out_stock_output = settings.output_asterisk %}
            {% endif %}

          {% endif %}

        {% endif %}

      {% elsif product.vendor == 'Retired B&I' %}

        {% if product.type == 'Fashion Jewelry' %}

          {% if lt_tag %}

            {% if policy == "deny" %}
              {% assign out_stock_output = settings.output_seven %}
            {% else %}
              {% assign out_stock_output = settings.output_two %}
            {% endif %}

          {% else %}

            {% if policy == "deny" %}
              {% assign out_stock_output = settings.output_seven %}
            {% else %}
              {% assign out_stock_output = settings.output_two %}
            {% endif %}

          {% endif %}

        {% elsif product.type == 'Fine Jewelry' %}
          {% if lt_tag %}

            {% if policy == "deny" %}
              {% assign out_stock_output = settings.output_seven %}
            {% else %}
              {% assign in_stock_output = settings.output_five %}
            {% endif %}

          {% else %}

            {% if policy == "deny" %}
              {% assign out_stock_output = settings.output_seven %}
            {% else %}
              {% assign in_stock_output = settings.output_four %}
            {% endif %}

          {% endif %}

        {% elsif product.type == 'Recast Fashion Jewelry' %}

          {% assign out_stock_output = settings.output_asterisk %}

        {% elsif product.type == 'Sold Out' %}

          {% if lt_tag %}

            {% if policy == "deny" %}
              {% assign out_stock_output = settings.output_seven %}
            {% else %}
              {% assign out_stock_output = settings.output_asterisk %}
            {% endif %}

          {% else %}

            {% if policy == "deny" %}
              {% assign out_stock_output = settings.output_seven %}
            {% else %}
              {% assign out_stock_output = settings.output_asterisk %}
            {% endif %}

          {% endif %}

        {% endif %}

      {% else %}
        {% if product.type == 'Fashion Jewelry' %}

          {% if lt_tag %}

            {% if policy == "deny" %}
              {% assign out_stock_output = settings.output_one %}
            {% else %}
              {% assign out_stock_output = settings.output_asterisk %}
            {% endif %}

          {% else %}

            {% if policy == "deny" %}
              {% assign out_stock_output = settings.output_one %}
            {% else %}
              {% assign out_stock_output = settings.output_asterisk %}
            {% endif %}

          {% endif %}

        {% elsif product.type == 'Fine Jewelry' %}
          {% if lt_tag %}

            {% if policy == "deny" %}
              {% assign out_stock_output = settings.output_one %}
            {% else %}
              {% assign in_stock_output = settings.output_five %}
            {% endif %}

          {% else %}

            {% if policy == "deny" %}
              {% assign out_stock_output = settings.output_one %}
            {% else %}
              {% assign in_stock_output = settings.output_five %}
            {% endif %}

          {% endif %}

        {% elsif product.type == 'Recast Fashion Jewelry' %}

          {% if lt_tag %}

            {% if policy == "deny" %}
              {% assign out_stock_output = settings.output_one %}
            {% else %}
              {% assign out_stock_output = settings.output_asterisk %}
            {% endif %}

          {% else %}

            {% if policy == "deny" %}
              {% assign out_stock_output = settings.output_one %}
            {% else %}
              {% assign out_stock_output = settings.output_asterisk %}
            {% endif %}

          {% endif %}

        {% elsif product.type == 'Sold Out' %}

          {% if lt_tag %}

            {% if policy == "deny" %}
              {% assign out_stock_output = settings.output_six %}
            {% else %}s
              {% assign out_stock_output = settings.output_asterisk %}
            {% endif %}

          {% else %}

            {% if policy == "deny" %}
              {% assign out_stock_output = settings.output_six %}
            {% else %}
              {% assign out_stock_output = settings.output_asterisk %}
            {% endif %}

          {% endif %}

        {% endif %}

      {% endif %}

    {% endif %}

    <div class="stock-message" id="inStockMsg">{{ in_stock_output }}</div>
    <div class="stock-message" id="inStockHasInv">{{ in_stock_has_inv_output }}</div>
    <div class="stock-message" id="longerLead">{{ settings.output_lt2 }}</div>
    <div class="stock-message" id="outOfStockMsg">{{ out_stock_output }}</div>

    {% assign metafields-data = '[' %}
    {%for variant in shsd_product_variants%}
     {% assign metafield-value = variant.metafields.lead.extended_lead_time %}
     {% assign metafields-data = metafields-data | append: '{"variant_id":"' | append: variant.id| append: '" , "metafield_value":"' | append: metafield-value | append: '"},' %}
    {%endfor%}
    {% assign metafields-data = metafields-data | append: ']'%}
    {% assign metafields-data = metafields-data | replace: ",]", "]"%}
    
    <span id="hidden-variant-metafields-container" style="display:none;">{{metafields-data}}</span>
    {% comment %}
    End Stock Logic Code
    {% endcomment %}
      </div>
      {%- if template.suffix != 'quick-buy-popover' -%}
        <store-pickup form-id="{{ product_form_id }}" class="product-form__store-availability-container">
          {%- render 'store-availability', product_variant: shsd_product_variants[0] -%}
        </store-pickup>
      {%- endif -%}
    {%- endcase -%}
  {%- endfor -%}

  {%- comment -%}
    IMPLEMENTATION NOTE: under rare circumstances, merchant may want to show selectors but hide the add to cart button. This
    is however problematic as elements changed based on this. So if we detect there is no buy buttons block, we add an empty one
  {%- endcomment -%}

  {%- assign buy_buttons_block = section.blocks | where: 'type', 'buy_buttons' | first -%}

  {%- if buy_buttons_block == blank -%}
    {%- form 'product', product, is: 'product-form', id: product_form_id -%}
      <input type="hidden" disabled name="id" value="{{ shsd_product_variants[0].id }}">
    {%- endform -%}
  {%- endif -%}
</div>

{%- if template.suffix == 'quick-buy-drawer' -%}
  <div class="product-form__view-details">
    <a href="{{ product.url }}" class="link text--subdued">{{ 'product.general.view_details' | t }}</a>
  </div>
{%- endif -%}

{%- comment -%}
  IMPLEMENTATION NOTE: if during the iteration of the options we have found an option matching a size chart, we add it here
{%- endcomment -%}

{%- if found_size_option and size_chart_page != blank -%}
  {%- comment -%}Drawer is for tablet and desktop{%- endcomment -%}
  <drawer-content id="product-{{ section.id }}-{{ product.id }}-size-chart-drawer" class="drawer drawer--large hidden-phone">
    <span class="drawer__overlay"></span>

    <header class="drawer__header">
      <p class="drawer__title heading h6">{{ size_chart_page.title }}</p>

      <button type="button" class="drawer__close-button tap-area" data-action="close" title="{{ 'general.accessibility.close' | t | escape }}">
        {%- render 'icon' with 'close' -%}
      </button>
    </header>

    <div class="drawer__content drawer__content--padded-start">
      <div class="rte">
        {{- size_chart_page.content -}}
      </div>
    </div>
  </drawer-content>

  {%- comment -%}Popover is for mobile{%- endcomment -%}
  <popover-content id="product-{{ section.id }}-{{ product.id }}-size-chart-popover" class="popover hidden-lap-and-up">
    <span class="popover__overlay"></span>

    <header class="popover__header">
      <p class="popover__title heading h6">{{ size_chart_page.title }}</p>

      <button type="button" class="popover__close-button tap-area tap-area--large" data-action="close" title="{{ 'general.accessibility.close' | t | escape }}">
        {%- render 'icon' with 'close' -%}
      </button>
    </header>

    <div class="popover__content">
      <div class="rte">
        {{- size_chart_page.content -}}
      </div>
    </div>
  </popover-content>
{%- endif -%}